# 프로토콜 스택?
컴퓨터와 컴퓨터가 네트워크로 통신하기 위해서는 프로토콜이 필요하다.  
네트워크 프로토콜은 프로토콜 스택이라는 계층을 거쳐 요청이 전달되도록 한다.

계층을 나누는 목적은 복잡한 과정을 계층을 나눠 단순화 시키고 역할을 정확하게 분담하기 위함이다.

프로토콜 스택이라고 불리는 이유는 실제 자료구조인 스택과 비슷하게 동작하기 때문이다.

## 프로토콜 스택의 5계층
프로토콜 스택은 총 5개의 계층을 가진다.  
Application, Transport, Network, Data Link, Physical 총 5개로 구성되어 있다.    
이렇게 구성된 계층은 각 계층이 맡아야될 책임을 가지고 요청을 처리한다.

#### Application(응용) 계층
가장 스택의 최상위 부분은 응용계층으로 이 계층에서는 송,수신측사이에 사용자가 사용하는 데이터를 주고받기 위한 서비스를 제공한다.
사용자가 네트워크에 접근할 수 있도록 해주고, 사용자 인터페이스와 네트워크 사이의 통신을 관리한다.  
HTTP, FTP, SMTP 등등의 여러 프로토콜이 여기서 작동한다.

#### Transport(전송) 계층
이 계층은 데이터 전송의 신뢰성을 보장하기 위한 계층이다.  
이 말은, 송신 TO 수신 관계에서 패킷이 정상적으로 전달되었는지 확인하는 역할을 수행한다.  
TCP, UDP로 나뉘며 두 프로토콜은 비슷하지만 서로다른 성질을 가지고 있다. 간단하게 말하면 연결 방식의 차이다.  
TCP 같은 경우는 3-way-handshake 과정이 필요하며, 이 과정을 통해 송신과 수신측의 신뢰성을 확보한다.
UDP는 이러한 과정이 생략되기 때문에, 신뢰성보다는 데이터 송신의 효율성을 더 확보하기 위한 프로토콜이다.

이 계층에서는 포트 번호를 사용하여 어떤 애플리케이션으로 데이터를 전달할지 결정한다.  
데이터는 세그먼트(Segment) 단위로 처리되며, TCP 헤더 또는 UDP 헤더가 추가된다.

#### Network(네트워크) 계층
네트워크 계층은 데이터를 목적지까지 전달하는 경로를 설정하는 계층이다.  
즉, 라우팅(Routing)을 담당한다고 볼 수 있다.

이 계층에서 가장 중요한 프로토콜은 IP(Internet Protocol)다.  
IP 주소를 사용하여 출발지와 목적지를 식별하고, 여러 네트워크를 거쳐 데이터를 전달한다.  
만약 목적지가 다른 네트워크에 있다면, 라우터를 통해 다음 경로로 데이터를 전달하는 방식이다.

데이터는 패킷(Packet) 단위로 처리되며, IP 헤더가 추가된다.  
IP 헤더에는 출발지 IP 주소와 목적지 IP 주소가 포함된다.

#### Data Link(데이터 링크) 계층
데이터 링크 계층은 같은 네트워크 내에서 직접 연결된 장치들 간의 데이터 전송을 담당한다.  
물리적으로 연결된 두 노드 사이의 신뢰성 있는 전송을 보장하는 것이 목표다.

이 계층에서는 MAC 주소를 사용하여 장치를 식별한다.  
MAC 주소는 네트워크 카드에 고유하게 할당된 물리적 주소다.

데이터는 프레임(Frame) 단위로 처리되며, Ethernet 헤더와 트레일러가 추가된다.  
이 계층에서는 오류 검출, 흐름 제어 등의 기능도 수행한다.

대표적인 프로토콜로는 Ethernet, Wi-Fi 등이 있다.

#### Physical(물리) 계층
물리 계층은 실제로 데이터를 전기 신호, 광 신호, 전파 등으로 변환하여 물리적 매체를 통해 전송하는 계층이다.  
0과 1의 비트 스트림을 물리적 신호로 변환하고, 반대로 수신 시에는 신호를 비트로 변환한다.

케이블의 종류, 전압 레벨, 신호의 타이밍 등 하드웨어적인 부분을 다룬다.  
네트워크 케이블, 허브, 리피터 등이 이 계층에서 동작한다.

## 데이터 송신 과정
데이터를 송신할 때는 Application 계층부터 Physical 계층까지 위에서 아래로 내려간다.  
각 계층을 지날 때마다 해당 계층의 헤더(일부 계층은 트레일러도)가 추가되는데, 이를 캡슐화(Encapsulation)라고 한다.
```
[Application] HTTP 메시지 작성
      ↓
[Transport] TCP 헤더 추가 → 세그먼트
      ↓
[Network] IP 헤더 추가 → 패킷
      ↓
[Data Link] Ethernet 헤더/트레일러 추가 → 프레임
      ↓
[Physical] 비트로 변환하여 전송
```

## 데이터 수신 과정
데이터를 수신할 때는 반대로 Physical 계층부터 Application 계층까지 아래에서 위로 올라간다.  
각 계층을 지날 때마다 해당 계층의 헤더를 제거하는데, 이를 역캡슐화(Decapsulation)라고 한다.
```
[Physical] 비트 스트림 수신
      ↓
[Data Link] Ethernet 헤더/트레일러 제거
      ↓
[Network] IP 헤더 제거 및 라우팅 확인
      ↓
[Transport] TCP 헤더 제거 및 포트 확인
      ↓
[Application] HTTP 메시지 수신
```

## 각 계층의 데이터 단위
- Application 계층: 메시지(Message)
- Transport 계층: 세그먼트(Segment)
- Network 계층: 패킷(Packet)
- Data Link 계층: 프레임(Frame)
- Physical 계층: 비트(Bit)
